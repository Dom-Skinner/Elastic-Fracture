function [kernel_matrix, interpolate_matrix] = pressure_shear_matrix(x,z,t)

n = length(x);
infinity = 10^10;

interpolate_matrix = linear_simpleinfty_interpolate(x,t);
function_matrix = zeros(2*(n-1),4*n);



%FINDS ALL THE KERNEL FUNCTIONS

K11x1 = @(x,z) real(4.*(4+3.*x.^2+(-4).*x.*z+z.^2).*(4+x.^2+(-2).*x.*z+z.^2).^(-2));

  
  
K11x0 = @(x,z) real(8.*(4+(x+(-1).*z).^2).^(-2).*(x+(-1).*z));

K11x2 = @(x,z) real(8.*x.*(4+2.*x.^2+(-3).*x.*z+z.^2).*(4+x.^2+(-2).*x.*z+z.^2).^(-2)+ ...
...
  (-4).*atan((1/2).*(x+(-1).*z)));

K11xmin1 = @(x,z) real(8.*(4+x.*z+(-1).*z.^2).*(4+z.^2).^(-1).*(4+x.^2+(-2).*x.*z+z.^2) ...
 ...
 .^(-2)+4.*(4+4.*x.*z+(-7).*z.^2).*(4+z.^2).^(-2).*(4+x.^2+(-2).* ...
...
  x.*z+z.^2).^(-1)+2.*((sqrt(-1)*(-2))+z).^(-3).*atan(2.*(x+(-1).*z) ...
...
  .^(-1))+2.*((sqrt(-1)*2)+z).^(-3).*atan(2.*(x+(-1).*z).^(-1))+(-8) ...
...
  .*(4+z.^2).^(-3).*((-4)+3.*z.^2).*log(x)+(sqrt(-1)*(-1)).*((sqrt( ...
...
  -1)*(-2))+z).^(-3).*log(4+x.^2+(-2).*x.*z+z.^2)+sqrt(-1).*((sqrt( ...
...
  -1)*2)+z).^(-3).*log(4+x.^2+(-2).*x.*z+z.^2));

K11xmin2 = @(x,z) real(8.*x.^(-1).*(4+z.^2).^(-3).*((-4)+3.*z.^2)+(-8).*(4+z.^2).^(-2).*( ...
...
  4+x.^2+(-2).*x.*z+z.^2).^(-2).*(4.*x+(-12).*z+(-1).*x.*z.^2+z.^3)+ ...
...
  8.*(4+z.^2).^(-3).*(4+x.^2+(-2).*x.*z+z.^2).^(-1).*(28.*z+(-9).* ...
...
  z.^3+x.*((-8)+6.*z.^2))+6.*((sqrt(-1)*(-2))+z).^(-4).*atan(2.*(x+( ...
...
  -1).*z).^(-1))+6.*((sqrt(-1)*2)+z).^(-4).*atan(2.*(x+(-1).*z).^( ...
...
  -1))+(-96).*z.*((-4)+z.^2).*(4+z.^2).^(-4).*log(x)+(sqrt(-1)*(-3)) ...
...
  .*((sqrt(-1)*(-2))+z).^(-4).*log(4+x.^2+(-2).*x.*z+z.^2)+(sqrt(-1) ...
...
  *3).*((sqrt(-1)*2)+z).^(-4).*log(4+x.^2+(-2).*x.*z+z.^2));

%finds the kernel K12

K12x1 = @(x,z) real(2.*(4+(x+(-1).*z).^2).^(-2).*((-8).*x+(-1).*(4+(x+(-1).*z).^2).*z) ...
  +(1/2).*z.*log(4+(x+(-1).*z).^2)+(-1).*z.*log(x+(-1).*z));
  
  
K12x0 = @(x,z) real((-2).*(4+x.^2+(-2).*x.*z+z.^2).^(-2).*(12+x.^2+(-2).*x.*z+z.^2)+( ...
  1/2).*log(4+(x+(-1).*z).^2)+(-1).*log(x+(-1).*z));

K12x2 = @(x,z) real((1/2).*(32.*(4+(-2).*x.*z+z.^2).*(4+x.^2+(-2).*x.*z+z.^2).^(-2)+( ...
...
  -4).*(12+z.^2).*(4+x.^2+(-2).*x.*z+z.^2).^(-1)+z.^2.*log(4+(x+(-1) ...
...
  .*z).^2)+(-2).*z.^2.*log(x+(-1).*z)));

K12xmin1 = @(x,z) real((1/4).*(64.*(4+(x+(-1).*z).^2).^(-2).*(x+(-2).*z).*(4+z.^2).^(-1)+ ...
...
  (-8).*(4+z.^2).^(-2).*(4+x.^2+(-2).*x.*z+z.^2).^(-1).*((-16).*x+ ...
...
  36.*z+z.^3)+(sqrt(-1)*2).*((sqrt(-1)*(-2))+z).^(-3).*((-12)+(sqrt( ...
...
  -1)*(-6)).*z+z.^2).*atan(2.*(x+(-1).*z).^(-1))+(sqrt(-1)*(-2)).*(( ...
...
  sqrt(-1)*2)+z).^(-3).*((-12)+(sqrt(-1)*6).*z+z.^2).*atan(2.*(x+( ...
...
  -1).*z).^(-1))+64.*z.^(-1).*(4+(-3).*z.^2).*(4+z.^2).^(-3).*log(x) ...
...
  +((sqrt(-1)*(-2))+z).^(-3).*((-12)+(sqrt(-1)*(-6)).*z+z.^2).*log( ...
...
  4+(x+(-1).*z).^2)+((sqrt(-1)*2)+z).^(-3).*((-12)+(sqrt(-1)*6).*z+ ...
...
  z.^2).*log(4+(x+(-1).*z).^2)+(-4).*z.^(-1).*log(x+(-1).*z)));

K12xmin2 = @(x,z) real((1/4).*(64.*(4+2.*x.*z+(-3).*z.^2).*(4+z.^2).^(-2).*(4+x.^2+(-2).* ...
...
  x.*z+z.^2).^(-2)+64.*x.^(-1).*z.^(-1).*(4+z.^2).^(-3).*((-4)+3.* ...
...
  z.^2)+(-8).*(4+z.^2).^(-3).*(4+x.^2+(-2).*x.*z+z.^2).^(-1).*((-80) ...
...
  +(-64).*x.*z+112.*z.^2+z.^4)+(sqrt(-1)*2).*((sqrt(-1)*(-2))+z).^( ...
...
  -4).*((-24)+(sqrt(-1)*(-8)).*z+z.^2).*atan(2.*(x+(-1).*z).^(-1))+( ...
...
  sqrt(-1)*(-2)).*((sqrt(-1)*2)+z).^(-4).*((-24)+(sqrt(-1)*8).*z+ ...
...
  z.^2).*atan(2.*(x+(-1).*z).^(-1))+64.*z.^(-2).*(4+z.^2).^(-4).*( ...
...
  16+40.*z.^2+(-15).*z.^4).*log(x)+((sqrt(-1)*(-2))+z).^(-4).*((-24) ...
...
  +(sqrt(-1)*(-8)).*z+z.^2).*log(4+(x+(-1).*z).^2)+((sqrt(-1)*2)+z) ...
...
  .^(-4).*((-24)+(sqrt(-1)*8).*z+z.^2).*log(4+(x+(-1).*z).^2)+(-4).* ...
...
  z.^(-2).*log(x+(-1).*z)));



%finds the kernel K21

K21x1 = @(x,z) -real(16.*x.*(4+(x+(-1).*z).^2).^(-2)+(-8).*x.*(4+(x+(-1).*z).^2).^(-1)+ ...
  2.*(4+(x+(-1).*z).^2).^(-1).*z+4.*atan((1/2).*(x+(-1).*z))+(-1/2) ...
  .*z.*log(4+(x+(-1).*z).^2)+z.*log(x+(-1).*z));
  
  
  
K21x0 = @(x,z) -real(2.*(8+(-3).*(4+(x+(-1).*z).^2)).*(4+(x+(-1).*z).^2).^(-2)+(-1/2).* ...
  log(4+(x+(-1).*z).^2)+log(x+(-1).*z));

K21x2 = @(x,z) -real(16.*((-4).*(4+(x+(-1).*z).^2).^(-2)+(7/2).*(4+(x+(-1).*z).^2).^( ...
 ...
 -1)+2.*x.*(4+(x+(-1).*z).^2).^(-2).*z+(-1).*x.*(4+(x+(-1).*z).^2) ...
...
  .^(-1).*z+(-1).*(4+(x+(-1).*z).^2).^(-2).*z.^2+(5/8).*(4+(x+(-1).* ...
...
  z).^2).^(-1).*z.^2+(-1/2).*z.*atan(2.*(x+(-1).*z).^(-1))+(-1/32).* ...
...
  ((-16)+z.^2).*log(4+(x+(-1).*z).^2)+(1/16).*z.^2.*log(x+(-1).*z)));

K21xmin1 = @(x,z) -real((1/4).*(64.*(4+(x+(-1).*z).^2).^(-2).*((-1).*x+2.*z).*(4+z.^2).^( ...
...
  -1)+8.*z.*(4+4.*x.*z+(-7).*z.^2).*(4+z.^2).^(-2).*(4+x.^2+(-2).* ...
...
  x.*z+z.^2).^(-1)+(sqrt(-1)*(-2)).*((sqrt(-1)*(-2))+z).^(-3).*((-4) ...
...
  +(sqrt(-1)*(-2)).*z+z.^2).*atan(2.*(x+(-1).*z).^(-1))+(sqrt(-1)*2) ...
...
  .*((sqrt(-1)*2)+z).^(-3).*((-4)+(sqrt(-1)*2).*z+z.^2).*atan(2.*(x+ ...
...
  (-1).*z).^(-1))+(-64).*z.^(-1).*(4+z.^2).^(-3).*(4+z.^2+z.^4).* ...
...
  log(x)+((sqrt(-1)*(-2))+z).^(-3).*(4+(sqrt(-1)*2).*z+(-1).*z.^2).* ...
...
  log(4+(x+(-1).*z).^2)+(-1).*((sqrt(-1)*2)+z).^(-3).*((-4)+(sqrt( ...
...
  -1)*2).*z+z.^2).*log(4+(x+(-1).*z).^2)+4.*z.^(-1).*log(x+(-1).*z)));

K21xmin2 = @(x,z) -real((1/4).*((-64).*(4+2.*x.*z+(-3).*z.^2).*(4+z.^2).^(-2).*(4+x.^2+( ...
 ...
 -2).*x.*z+z.^2).^(-2)+64.*x.^(-1).*z.^(-1).*(4+z.^2).^(-3).*(4+ ...
 ...
 z.^2+z.^4)+8.*(4+z.^2).^(-3).*(4+x.^2+(-2).*x.*z+z.^2).^(-1).*(( ...
...
  -16)+80.*z.^2+(-11).*z.^4+8.*x.*z.*((-4)+z.^2))+(sqrt(-1)*(-2)).*( ...
...
  (sqrt(-1)*(-2))+z).^(-4).*((-8)+z.^2).*atan(2.*(x+(-1).*z).^(-1))+ ...
...
  (sqrt(-1)*2).*((sqrt(-1)*2)+z).^(-4).*((-8)+z.^2).*atan(2.*(x+(-1) ...
...
  .*z).^(-1))+(-64).*z.^(-2).*(4+z.^2).^(-4).*(16+24.*z.^2+(-7).* ...
...
  z.^4+3.*z.^6).*log(x)+(-1).*((sqrt(-1)*(-2))+z).^(-4).*((-8)+z.^2) ...
...
  .*log(4+(x+(-1).*z).^2)+(-1).*((sqrt(-1)*2)+z).^(-4).*((-8)+z.^2) ...
...
  .*log(4+(x+(-1).*z).^2)+4.*z.^(-2).*log(x+(-1).*z)));



%finds the kernel K22

K22x1 = @(x,z) -real(4.*(4+3.*x.^2+(-4).*x.*z+z.^2).*(4+x.^2+(-2).*x.*z+z.^2).^(-2));

  
  
K22x0 = @(x,z) -real(8.*(4+(x+(-1).*z).^2).^(-2).*(x+(-1).*z));

K22x2 = @(x,z) -real(8.*x.*(4+2.*x.^2+(-3).*x.*z+z.^2).*(4+x.^2+(-2).*x.*z+z.^2).^(-2)+ ...
...
  (-4).*atan((1/2).*(x+(-1).*z)));

K22xmin1 = @(x,z) -real(8.*(4+x.*z+(-1).*z.^2).*(4+z.^2).^(-1).*(4+x.^2+(-2).*x.*z+z.^2) ...
 ...
 .^(-2)+4.*(4+4.*x.*z+(-7).*z.^2).*(4+z.^2).^(-2).*(4+x.^2+(-2).* ...
...
  x.*z+z.^2).^(-1)+2.*((sqrt(-1)*(-2))+z).^(-3).*atan(2.*(x+(-1).*z) ...
...
  .^(-1))+2.*((sqrt(-1)*2)+z).^(-3).*atan(2.*(x+(-1).*z).^(-1))+(-8) ...
...
  .*(4+z.^2).^(-3).*((-4)+3.*z.^2).*log(x)+(sqrt(-1)*(-1)).*((sqrt( ...
...
  -1)*(-2))+z).^(-3).*log(4+x.^2+(-2).*x.*z+z.^2)+sqrt(-1).*((sqrt( ...
...
  -1)*2)+z).^(-3).*log(4+x.^2+(-2).*x.*z+z.^2));

K22xmin2 = @(x,z) -real(8.*x.^(-1).*(4+z.^2).^(-3).*((-4)+3.*z.^2)+(-8).*(4+z.^2).^(-2).*( ...
...
  4+x.^2+(-2).*x.*z+z.^2).^(-2).*(4.*x+(-12).*z+(-1).*x.*z.^2+z.^3)+ ...
...
  8.*(4+z.^2).^(-3).*(4+x.^2+(-2).*x.*z+z.^2).^(-1).*(28.*z+(-9).* ...
...
  z.^3+x.*((-8)+6.*z.^2))+6.*((sqrt(-1)*(-2))+z).^(-4).*atan(2.*(x+( ...
...
  -1).*z).^(-1))+6.*((sqrt(-1)*2)+z).^(-4).*atan(2.*(x+(-1).*z).^( ...
...
  -1))+(-96).*z.*((-4)+z.^2).*(4+z.^2).^(-4).*log(x)+(sqrt(-1)*(-3)) ...
...
  .*((sqrt(-1)*(-2))+z).^(-4).*log(4+x.^2+(-2).*x.*z+z.^2)+(sqrt(-1) ...
...
  *3).*((sqrt(-1)*2)+z).^(-4).*log(4+x.^2+(-2).*x.*z+z.^2));


K11sqrtx3int = @(x,z) 2.*x.^(3/2).*(4+x.^2+(-2).*x.*z+z.^2).^(-2).*(20+9.*x.^2+(-14).* ...
 ...
 x.*z+5.*z.^2)+(sqrt(-1)*(-15/2)).*((sqrt(-1)*(-2))+(-1).*z).^(1/2) ...
...
  .*atan(x.^(1/2).*((sqrt(-1)*(-2))+(-1).*z).^(-1/2))+(sqrt(-1)*( ...
...
  15/2)).*((sqrt(-1)*2)+(-1).*z).^(1/2).*atan(x.^(1/2).*((sqrt(-1)* ...
...
  2)+(-1).*z).^(-1/2));


  

K11sqrtx2 = @(x,z) real(2.*x.^(1/2).*(4+x.^2+(-2).*x.*z+z.^2).^(-2).*(12+7.*x.^2+(-10).* ...
 ...
 x.*z+3.*z.^2)+(sqrt(-1)*(3/2)).*((sqrt(-1)*(-2))+(-1).*z).^(-1/2) ...
...
  .*atan(x.^(1/2).*((sqrt(-1)*(-2))+(-1).*z).^(-1/2))+(sqrt(-1)*( ...
...
  -3/2)).*((sqrt(-1)*2)+(-1).*z).^(-1/2).*atan(x.^(1/2).*((sqrt(-1)* ...
...
  2)+(-1).*z).^(-1/2)));
  

K11sqrtx1 = @(x,z) real((-2).*x.^(1/2).*(4+z.^2).^(-1).*(4+x.^2+(-2).*x.*z+z.^2).^(-2).*( ...
...
  x.^3+(-4).*x.^2.*z+x.*((-12)+z.^2)+2.*z.*(4+z.^2))+(sqrt(-1)*(1/2) ...
...
  ).*((sqrt(-1)*(-2))+(-1).*z).^(-3/2).*atan(x.^(1/2).*((sqrt(-1)*( ...
...
  -2))+(-1).*z).^(-1/2))+(sqrt(-1)*(-1/2)).*((sqrt(-1)*2)+(-1).*z) ...
...
  .^(-3/2).*atan(x.^(1/2).*((sqrt(-1)*2)+(-1).*z).^(-1/2)));
  
  
  
K11sqrtx0 = @(x,z) real(2.*x.^(1/2).*(4+z.^2).^(-2).*(4+x.^2+(-2).*x.*z+z.^2).^(-2).*(6.* ...
...
  x.^3.*z+x.^2.*(4+(-23).*z.^2)+32.*x.*(z+z.^3)+(-5).*((-16)+8.* ...
 ...
 z.^2+3.*z.^4))+(sqrt(-1)*(3/2)).*((sqrt(-1)*(-2))+(-1).*z).^(-5/2) ...
...
  .*atan(x.^(1/2).*((sqrt(-1)*(-2))+(-1).*z).^(-1/2))+(sqrt(-1)*( ...
...
  -3/2)).*((sqrt(-1)*2)+(-1).*z).^(-5/2).*atan(x.^(1/2).*((sqrt(-1)* ...
...
  2)+(-1).*z).^(-1/2)));

%finds the kernel K12

K12sqrtx3 = @(x,z) real((1/2).*(2.*x.^(1/2).*(4+x.^2+(-2).*x.*z+z.^2).^(-2).*(x.^3.*z+7.* ...
...
  x.*z.*(4+z.^2)+(-3).*(4+z.^2).^2+(-1).*x.^2.*(28+5.*z.^2))+((sqrt( ...
...
  -1)*2)+(-1).*z).^(-1/2).*((sqrt(-1)*6)+z+(sqrt(-1)*(-2)).*z.^2+2.* ...
...
  z.^3).*atan(x.^(1/2).*((sqrt(-1)*2)+(-1).*z).^(-1/2))+4.*z.^(5/2) ...
...
  .*atanh(x.^(1/2).*z.^(-1/2))+(-1).*((sqrt(-1)*2)+z).^(-1/2).*(( ...
...
  sqrt(-1)*(-6))+z+(sqrt(-1)*2).*z.^2+2.*z.^3).*atanh(x.^(1/2).*(( ...
...
  sqrt(-1)*2)+z).^(-1/2))));

K12sqrtx2 = @(x,z) real((1/2).*(2.*x.^(1/2).*((-16).*x+(4+(x+(-1).*z).^2).*(x+(-3).*z)).*( ...
...
  4+(x+(-1).*z).^2).^(-2)+((sqrt(-1)*2)+(-1).*z).^(-1/2).*(1+(sqrt( ...
...
  -1)*(-2)).*z+2.*z.^2).*atan(x.^(1/2).*((sqrt(-1)*2)+(-1).*z).^( ...
...
  -1/2))+4.*z.^(3/2).*atanh(x.^(1/2).*z.^(-1/2))+(-1).*((sqrt(-1)*2) ...
...
  +z).^(-1/2).*(1+(sqrt(-1)*2).*z+2.*z.^2).*atanh(x.^(1/2).*((sqrt( ...
...
  -1)*2)+z).^(-1/2))));

K12sqrtx1 = @(x,z) real((1/2).*(2.*x.^(1/2).*(4+(x+(-1).*z).^2).^(-2).*((-16)+((-4)+x.*z+( ...
...
  -3).*z.^2).*(4+z.^2).^(-1).*(4+x.^2+(-2).*x.*z+z.^2))+(-1).*(( ...
 ...
 sqrt(-1)*2)+(-1).*z).^(-3/2).*((-3)+(sqrt(-1)*(-6)).*z+2.*z.^2).* ...
...
  atan(x.^(1/2).*((sqrt(-1)*2)+(-1).*z).^(-1/2))+4.*z.^(1/2).*atanh( ...
...
  x.^(1/2).*z.^(-1/2))+(-1).*((sqrt(-1)*2)+z).^(-3/2).*((-3)+(sqrt( ...
...
  -1)*6).*z+2.*z.^2).*atanh(x.^(1/2).*((sqrt(-1)*2)+z).^(-1/2))));
  
  
K12sqrtx0 = @(x,z) real((1/2).*(2.*x.^(1/2).*(4+(x+(-1).*z).^2).^(-2).*(4+z.^2).^(-2).*( ...
 ...
 16.*(x+(-2).*z).*(4+z.^2)+(4+x.^2+(-2).*x.*z+z.^2).*((-3).*z.*(20+ ...
...
  z.^2)+x.*(28+z.^2)))+((sqrt(-1)*2)+(-1).*z).^(-5/2).*((-15)+(sqrt( ...
...
  -1)*(-10)).*z+2.*z.^2).*atan(x.^(1/2).*((sqrt(-1)*2)+(-1).*z).^( ...
...
  -1/2))+4.*z.^(-1/2).*atanh(x.^(1/2).*z.^(-1/2))+(-1).*((sqrt(-1)* ...
...
  2)+z).^(-5/2).*((-15)+(sqrt(-1)*10).*z+2.*z.^2).*atanh(x.^(1/2).*( ...
...
  (sqrt(-1)*2)+z).^(-1/2))));



%finds the kernel K21

K21sqrtx3 = @(x,z) -real(((1/2).*(2.*x.^(1/2).*(4+x.^2+(-2).*x.*z+z.^2).^(-2).*(32.*x.^4+( ...
 ...
 -145).*x.^3.*z+(-167).*x.*z.*(4+z.^2)+43.*(4+z.^2).^2+79.*x.^2.*( ...
...
  4+3.*z.^2))+((sqrt(-1)*2)+(-1).*z).^(-1/2).*((sqrt(-1)*(-86))+79.* ...
...
  z+(sqrt(-1)*22).*z.^2+(-2).*z.^3).*atan(x.^(1/2).*((sqrt(-1)*2)+( ...
...
  -1).*z).^(-1/2))+(-4).*z.^(5/2).*atanh(x.^(1/2).*z.^(-1/2))+(( ...
 ...
 sqrt(-1)*2)+z).^(-1/2).*((sqrt(-1)*(-86))+(-79).*z+(sqrt(-1)*22).* ...
...
  z.^2+2.*z.^3).*atanh(x.^(1/2).*((sqrt(-1)*2)+z).^(-1/2)))));

K21sqrtx2 = @(x,z) -real(((1/2).*(32.*x.^(1/2).*(x.*(4+(x+(-1).*z).^2).^(-2)+(1/16).*((-9).* ...
...
  x+3.*z).*(4+x.^2+(-2).*x.*z+z.^2).^(-1))+((sqrt(-1)*2)+(-1).*z).^( ...
...
  -1/2).*(23+(sqrt(-1)*14).*z+(-2).*z.^2).*atan(x.^(1/2).*((sqrt(-1) ...
...
  *2)+(-1).*z).^(-1/2))+(-4).*z.^(3/2).*atanh(x.^(1/2).*z.^(-1/2))+( ...
...
  (sqrt(-1)*2)+z).^(-1/2).*((-23)+(sqrt(-1)*14).*z+2.*z.^2).*atanh( ...
...
  x.^(1/2).*((sqrt(-1)*2)+z).^(-1/2)))));


K21sqrtx1 = @(x,z) -real((1/2).*(32.*x.^(1/2).*((4+(x+(-1).*z).^2).^(-2)+(-1/16).*(4+z.^2) ...
...
  .^(-1).*(4+x.^2+(-2).*x.*z+z.^2).^(-1).*(28+x.*z+5.*z.^2))+((sqrt( ...
...
  -1)*2)+(-1).*z).^(-3/2).*((-11)+(sqrt(-1)*(-10)).*z+2.*z.^2).* ...
 ...
 atan(x.^(1/2).*((sqrt(-1)*2)+(-1).*z).^(-1/2))+(-4).*z.^(1/2).* ...
 ...
 atanh(x.^(1/2).*z.^(-1/2))+((sqrt(-1)*2)+z).^(-3/2).*((-11)+(sqrt( ...
...
  -1)*10).*z+2.*z.^2).*atanh(x.^(1/2).*((sqrt(-1)*2)+z).^(-1/2))));
  
  
  
K21sqrtx0 = @(x,z) -real((1/2).*(2.*x.^(1/2).*(4+(x+(-1).*z).^2).^(-2).*(4+z.^2).^(-2).*(( ...
...
  -16).*(x+(-2).*z).*(4+z.^2)+(4+x.^2+(-2).*x.*z+z.^2).*(4.*x+(-4).* ...
...
  z+7.*x.*z.^2+(-13).*z.^3))+(-1).*((sqrt(-1)*2)+(-1).*z).^(-5/2).*( ...
...
  (-7)+(sqrt(-1)*(-6)).*z+2.*z.^2).*atan(x.^(1/2).*((sqrt(-1)*2)+( ...
...
  -1).*z).^(-1/2))+(-4).*z.^(-1/2).*atanh(x.^(1/2).*z.^(-1/2))+(( ...
...
  sqrt(-1)*2)+z).^(-5/2).*((-7)+(sqrt(-1)*6).*z+2.*z.^2).*atanh(x.^( ...
...
  1/2).*((sqrt(-1)*2)+z).^(-1/2))));




%finds the kernel K22


K22sqrtx3 = @(x,z) -real((2.*x.^(3/2).*(4+x.^2+(-2).*x.*z+z.^2).^(-2).*(20+9.*x.^2+(-14).* ...
 ...
 x.*z+5.*z.^2)+(sqrt(-1)*(-15/2)).*((sqrt(-1)*(-2))+(-1).*z).^(1/2) ...
...
  .*atan(x.^(1/2).*((sqrt(-1)*(-2))+(-1).*z).^(-1/2))+(sqrt(-1)*( ...
...
  15/2)).*((sqrt(-1)*2)+(-1).*z).^(1/2).*atan(x.^(1/2).*((sqrt(-1)* ...
...
  2)+(-1).*z).^(-1/2))));
  

K22sqrtx2 = @(x,z) -real((2.*x.^(1/2).*(4+x.^2+(-2).*x.*z+z.^2).^(-2).*(12+7.*x.^2+(-10).* ...
 ...
 x.*z+3.*z.^2)+(sqrt(-1)*(3/2)).*((sqrt(-1)*(-2))+(-1).*z).^(-1/2) ...
...
  .*atan(x.^(1/2).*((sqrt(-1)*(-2))+(-1).*z).^(-1/2))+(sqrt(-1)*( ...
...
  -3/2)).*((sqrt(-1)*2)+(-1).*z).^(-1/2).*atan(x.^(1/2).*((sqrt(-1)* ...
...
  2)+(-1).*z).^(-1/2))));
  
  


K22sqrtx1 = @(x,z) -real((-2).*x.^(1/2).*(4+z.^2).^(-1).*(4+x.^2+(-2).*x.*z+z.^2).^(-2).*( ...
...
  x.^3+(-4).*x.^2.*z+x.*((-12)+z.^2)+2.*z.*(4+z.^2))+(sqrt(-1)*(1/2) ...
...
  ).*((sqrt(-1)*(-2))+(-1).*z).^(-3/2).*atan(x.^(1/2).*((sqrt(-1)*( ...
...
  -2))+(-1).*z).^(-1/2))+(sqrt(-1)*(-1/2)).*((sqrt(-1)*2)+(-1).*z) ...
...
  .^(-3/2).*atan(x.^(1/2).*((sqrt(-1)*2)+(-1).*z).^(-1/2)));
  
  
  
K22sqrtx0 = @(x,z) -real(2.*x.^(1/2).*(4+z.^2).^(-2).*(4+x.^2+(-2).*x.*z+z.^2).^(-2).*(6.* ...
...
  x.^3.*z+x.^2.*(4+(-23).*z.^2)+32.*x.*(z+z.^3)+(-5).*((-16)+8.* ...
 ...
 z.^2+3.*z.^4))+(sqrt(-1)*(3/2)).*((sqrt(-1)*(-2))+(-1).*z).^(-5/2) ...
...
  .*atan(x.^(1/2).*((sqrt(-1)*(-2))+(-1).*z).^(-1/2))+(sqrt(-1)*( ...
...
  -3/2)).*((sqrt(-1)*2)+(-1).*z).^(-5/2).*atan(x.^(1/2).*((sqrt(-1)* ...
...
  2)+(-1).*z).^(-1/2)));








for i=1:n-1
    %goes over the 1/sqrt(x) panels
    for j=1:t-1
        lx = x(j);
        ux = x(j+1);
        %for K11
        function_matrix(i,j) = K11sqrtx1(ux,z(i))-K11sqrtx1(lx,z(i));
        function_matrix(i,n+j) = K11sqrtx0(ux,z(i))-K11sqrtx0(lx,z(i));
        %for K12
        function_matrix(i,2*n+j) = K12sqrtx1(ux,z(i))-K12sqrtx1(lx,z(i));
        function_matrix(i,2*n+n+j) = K12sqrtx0(ux,z(i))-K12sqrtx0(lx,z(i));
        %for K21
        function_matrix(n-1+i,j) = K21sqrtx1(ux,z(i))-K21sqrtx1(lx,z(i));
        function_matrix(n-1+i,n+j) = K21sqrtx0(ux,z(i))-K21sqrtx0(lx,z(i));
        %for K22
        function_matrix(n-1+i,2*n+j) = K22sqrtx1(ux,z(i))-K22sqrtx1(lx,z(i));
        function_matrix(n-1+i,2*n+n+j) = K22sqrtx0(ux,z(i))-K22sqrtx0(lx,z(i));
    end
    %goes over the linear panels including infinity
    for j=t:n
        if j==n
            lx = x(n);
            ux = infinity;
        else
            lx = x(j);
            ux = x(j+1);
        end
        function_matrix(i,j) = K11x1(ux,z(i))-K11x1(lx,z(i));
        function_matrix(i,n+j) = K11x0(ux,z(i))-K11x0(lx,z(i));
        %for K12
        function_matrix(i,2*n+j) = K12x1(ux,z(i))-K12x1(lx,z(i));
        function_matrix(i,2*n+n+j) = K12x0(ux,z(i))-K12x0(lx,z(i));
        %for K21
        function_matrix(n-1+i,j) = K21x1(ux,z(i))-K21x1(lx,z(i));
        function_matrix(n-1+i,n+j) = K21x0(ux,z(i))-K21x0(lx,z(i));
        %for K22
        function_matrix(n-1+i,2*n+j) = K22x1(ux,z(i))-K22x1(lx,z(i));
        function_matrix(n-1+i,2*n+n+j) = K22x0(ux,z(i))-K22x0(lx,z(i));        
    end    
end        

kernel_matrix = function_matrix*interpolate_matrix;

return
end
    